<!DOCTYPE html>
<html>
<head>
  <title>Your Page Title</title>
  <link rel="stylesheet" href="main.css">
</head>
<body>
<h1 id="starknet-setup-tutorial">Starknet setup tutorial</h1>
<p>In this tutorial we are going to install the <a href="https://www.starknet.io/en/what-is-starknet">Starknet</a> CLI, deploy and interact with a Starknet smart contract.</p>
<p>This tutorial is for complete newcomers to Starknet and Linux, like me, therefore it is possible that some steps are redundand, or could be carried out in a more efficient way. For any clarification you can contact me at lapofalcone@gmail.com <sup>Possibly use TUTORIAL STARKNET as subject.</sub></p>
<p>I&#39;ve personally used these steps to install the CLI. By the way, take into account that Starknet is in development, therefore <strong>things may change quickly</strong> (I published this tutorial In July 2023, as part of <a href="https://github.com/Lapo9/Layer-2-Blockchains-for-Videogames">a report about the usage of blockchains for videogames</a>).</p>
<p>For example, in this tutorial we install <a href="https://book.cairo-lang.org/">Cairo</a> (the language in which to write smart contracts on Starknet) version 1.1.1. By the way Starknet will soon support Cairo 2.x.</p>
<p>Users can interact with Starknet via a CLI available for Linux and MacOS. We are going to
see how to create a smart contract and interact with it in Linux.</p>
<h2 id="prerequisites">Prerequisites</h2>
<p>We are going to work on a clean installation of Ubuntu 22.04.2 LTS, installed on a virtual
machine in VirtualBox.</p>
<h2 id="install-python3-9">Install Python3.9</h2>
<p>As of July 2023, Starknet CLI can work with <span class="keyword">Python3.9</span>, but not with <span class="keyword">Python3.10</span> yet. Since
<span class="keyword">Python3.10</span> is the default version on Ubuntu 22.04.2, we must install <span class="keyword">Python3.9</span> and create
a virtual environment for it.</p>
<pre><code class="lang-bash"><span class="keyword">sudo</span> <span class="keyword">apt</span> update
<span class="keyword">sudo</span> <span class="keyword">apt</span> install software-properties-common
<span class="keyword">sudo</span> <span class="keyword">add-apt-repository</span> ppa:deadsnakes/ppa <span class="comment"># Python3 .9 is not directly available</span>
<span class="keyword">sudo</span> <span class="keyword">apt</span> install <span class="keyword">python3.9</span>
<span class="keyword">python3.9</span> --version <span class="comment"># should return Python 3.9.1x</span>
</code></pre>
<p>Then we have to install some <span class="keyword">Python3.9</span> modules:</p>
<pre><code class="lang-bash"><span class="keyword">sudo</span> <span class="keyword">apt-get</span> install python3.9-distutils <span class="comment"># necessary to install some other modules</span>
<span class="keyword">sudo</span> <span class="keyword">apt-get</span> install python3.9-dev <span class="comment"># necessary to install some other modules</span>
<span class="keyword">sudo</span> <span class="keyword">apt-get</span> install python3.9-venv <span class="comment"># to create virtual environments</span>
</code></pre>
<p>Now we can create the virtual environment and activate it:</p>
<pre><code class="lang-bash"><span class="keyword">python3.9</span> -m venv ∼/cairo_venv
<span class="keyword">source</span> ∼/cairo_venv/bin/activate
<span class="comment"># next lines in the terminal should start with ( cairo_venv )</span>
</code></pre>
<p>From now on all commands will be run inside the virtual environment, where the default
version of <span class="keyword">Python</span> is 3.9.</p>
<h2 id="install-cairo-and-starknet">Install Cairo and Starknet</h2>
<p>First, we have to install these dependencies:</p>
<pre><code class="lang-bash"><span class="keyword">sudo</span> <span class="keyword">apt</span> install -y libgmp3-dev <span class="comment">#for multiple precision arithmetic</span>
<span class="keyword">sudo</span> <span class="keyword">apt</span> install <span class="keyword">git</span> <span class="comment">#will be used later on</span>
<span class="keyword">curl</span> --proto ’= https ’ --tlsv1.2 -sSf https://sh.rustup.rs | sh <span class="comment">#Rust</span>
<span class="keyword">pip</span> install wheel <span class="comment">#install if the installation of fastecdsa fails</span>
<span class="keyword">pip</span> install ecdsa <span class="comment">#cryptographic algorithm</span>
<span class="keyword">pip</span> install fastecdsa <span class="comment">#cryptographic algorithm</span>
<span class="keyword">pip</span> install sympy <span class="comment">#symbolic math</span>
</code></pre>
<p>Now we can install the Starknet CLI:</p>
<pre><code class="lang-bash"><span class="keyword">pip</span> install cairo-lang
<span class="keyword">starknet</span> --version <span class="comment">#should return 0.12.0</span>
</code></pre>
<p>And the Cairo compiler <sup>I found out that there is a bug preventing using mappings (<code>LegacyMapping</code>) inside contracts. A
workaround is to comment out line 71 at <code>.cairo/crates/cairo-lang-sierra-gas/src/gas_info.rs</code>. The
underlying problem has something to do with a check on the estimated gas consumed by the contract.</sup></p>
<pre><code class="lang-bash"><span class="keyword">git</span> clone https://github.com/starkware-libs/cairo .cairo <span class="comment">#we download the repo to ∼/.cairo</span>
<span class="keyword">cd</span> .cairo <span class="comment">#we move to the newly created folder</span>
<span class="keyword">git</span> checkout tags/v1.1.1 <span class="comment">#we move to the release branch, v1.1.1 is the last supported version on Starknet</span>
<span class="keyword">cargo</span> build --all --release <span class="comment">#we build the compiler via Cargo</span>
<span class="keyword">cd</span> .. <span class="comment">#we move back to the home folder</span>
</code></pre>
<h2 id="setting-up-environment-variables">Setting up environment variables</h2>
<p>To set permanent environment variables we have to append content to <code>~\.bashrc</code> file:</p>
<pre><code class="lang-bash"><span class="keyword">nano</span> ∼/.bashrc <span class="comment"># open .bashrc with a text editor</span></code></pre>
<p>Now write these variables at the end of the file:</p>
<pre><code class="lang-bash"><span class="keyword">export</span> STARKNET_NETWORK=alpha-goerli <span class="comment">#the Starknet network we will use (in this case thetestnet)</span>
<span class="keyword">export</span> STARKNET_WALLET=starkware.starknet.wallets.open_zeppelin.OpenZeppelinAccount <span class="comment">#the service to create account contract</span>
<span class="keyword">export</span> CAIRO_COMPILER_DIR=∼/.cairo/target/release/ <span class="comment">#where Cairo compiler is placed</span>
<span class="keyword">export</span> CAIRO_COMPILER_ARGS=--add-pythonic-hints <span class="comment">#Cairo compiler options</span></code></pre>
<p>Now press <code>Ctrl + X</code>, then <code>y</code> and finally <code>Enter</code>.</p>
<p>Now close and re-open the terminal (don’t forget to re-activate the virtual environment when
you re-open the terminal).</p>
<p>You can test if the environment variables we added exist with the command <code>printenv</code>.</p>
<h2 id="creating-an-account">Creating an account</h2>
<p>To create a Starknet account:</p>
<pre><code class="lang-bash"><span class="keyword">starknet</span> <span class="keyword">new_account</span> --account myAccountName
</code></pre>
<p>This will generate the address and the public-private key pair of the account, which will be
printed in the terminal and also saved to
<code>~/.starknet_accounts/starknet_open_zeppelin_accounts.json</code>.</p>
<p>Now we have to add some funds to the account, so that we can use them to deploy the
account contract.</p>
<p>To do so we can use any Starknet faucet, for example: <a href="https://faucet.goerli.starknet">https://faucet.goerli.starknet</a>.
io/.</p>
<p>Then we can check on <a href="https://starkscan.co/">https://starkscan.co/</a> that the transaction with the funds is at
least in Pending state.</p>
<p>At this point, we can deploy the account:</p>
<pre><code class="lang-bash"><span class="keyword">starknet</span> <span class="keyword">deploy_account</span> <span class="comment">--account myAccountName</span>
</code></pre>
<p>This will return the transaction hash: we must wait until the transaction is accepted on
layer 2.</p>
<h2 id="deploying-and-interacting-with-a-smart-contract">Deploying and interacting with a smart contract</h2>
<p>To deploy a smart contract, first, we must have some Cairo code. There are some examples
online, such as <a href="https://github.com/starknet-edu/deploy-cairo1-demo">https://github.com/starknet-edu/deploy-cairo1-demo</a>.</p>
<p>Let’s say we have the code for the contract at <code>~/src/myContract.cairo</code>.</p>
<p>First, we have to compile the Cairo code into Sierra bytecode:</p>
<pre><code class="lang-bash">∼/.cairo/target/release/starknet -compile ~/src/myContract.cairo ~/src/myContract.json
</code></pre>
<p>Then, we have to declare the smart contract. This will create a Class object in Starknet,
which is a template containing our code:</p>
<pre><code class="lang-bash"><span class="keyword">starknet</span> <span class="keyword">declare</span> --contract ∼/src/myContract.json --account myAccountName
</code></pre>
<p>Now we have to wait until the transaction declaring the contract is accepted on layer 2.</p>
<p>Eventually, we have to deploy the contract. A smart contract will be created starting from
the Class.</p>
<pre><code class="lang-bash"><span class="keyword">starknet</span> <span class="keyword">deploy</span> --class_hash HASH_OF_THE_PREVIOUSLY_CREATED_CLASS --inputs CONSTRUCTOR_ARGS --account myAccountName
</code></pre>
<p>As soon as the deploying transaction is accepted on layer 2, we can interact with the account:</p>
<pre><code class="lang-bash"><span class="keyword">starknet</span> <span class="keyword">invoke</span> --address SC_ADDRESS --function FUNCTION_NAME --inputs FUNCTION_ARGS --account myAccountName
</code></pre>
<p>And we can also interact with the read-only functions of the contract via:</p>
<pre><code class="lang-bash"><span class="keyword">starknet</span> <span class="keyword">call -</span>-address SM_ADDRESS --function FUNCTION_NAME --inputs FUNCTION_ARGS --account myAccountName
</code></pre>

    